# Simplified Configuration - Single Unified Loss Objective
# Philosophy: ONE reconstruction loss (like SRDRN) + KL regularization
# Avoids multi-objective trade-offs!

# Data paths
data_root: "/scratch/user/u.hn319322/ondemand/Downscaling/cVAE_augmentation"
outputs_root: "/scratch/user/u.hn319322/ondemand/Downscaling/cVAE_augmentation/outputs/cvae_simplified"

# Static maps configuration
statics:
  use_land_sea: true
  use_dist_coast: true
  use_elevation: false
  normalize_statics: true

# Model architecture - Reduced size
model:
  d_x: 64
  in_channels_X: 6
  d_y: 256
  in_channels_Y: 1
  static_channels: 2
  d_z: 64
  H: 156
  W: 132
  base_filters: 64  # Reduced from 96 (less overfitting)

# Loss function - SIMPLIFIED!
loss:
  type: "simplified"  # Use SimplifiedCVAELoss instead of CVAELoss

  # Intensity weighting (like SRDRN)
  scale: 36.6         # Weighting scale (light rain: w=0.1, heavy rain: w=2.0)
  w_min: 0.1          # Min weight
  w_max: 2.0          # Max weight (20Ã— more than light rain!)

  # Extra boost for extreme tail (P99+)
  tail_boost: 1.5     # 1.5 = 50% extra weight for P99+ pixels
                      # 1.0 = no boost (just intensity weighting)
                      # 2.0 = 100% extra weight

  # Mass conservation (optional, small weight)
  lambda_mass: 0.005  # Reduced from 0.01 (less constraint)

  # KL divergence (required for VAE)
  beta_kl: 0.01       # Light regularization
  warmup_epochs: 15   # KL warm-up

  p99_threshold: "from_thresholds_json"  # Will load P99=4.26

# Training configuration
train:
  epochs: 150
  batch_size: 64
  num_workers: 2
  lr: 0.0001
  weight_decay: 0.0005  # Increased regularization
  grad_clip: 1.0
  amp: true
  save_every: 10
  early_stopping_patience: 40  # More patient
  early_stopping_metric: "MAE_tail"  # Optimize directly for extremes!

# Learning rate scheduler
scheduler:
  type: "cosine"
  T_max: 150
  eta_min: 0.000001

# Validation
validation:
  val_every: 1
  log_every: 50

# Sampling
sampling:
  mode: "posterior"
  K: 5
  days: "heavy_only"
  min_threshold: 0.1
  temperature: 1.0

# Device
device: "cuda"
seed: 42
